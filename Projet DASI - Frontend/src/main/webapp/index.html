<!DOCTYPE html>
<html>
    <head>
        <title>Predicti'if Accueil</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="STYLES/main.css">
        <link rel="stylesheet" href="STYLES/index.css">
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    </head>
    <body style="display: none;">

        <!-- HEADER / FOOTER -->
        <div class="header">
            <a href="index.html" class="logo">Predict'IF</a>
            <div class="header-right" id='headerContent'>
                <a href="#" id="boutonPopupConnexion1">Se connecter</a>
                <a href="#" id="boutonPopupInscription1">S'inscrire</a>
            </div>
        </div> 
        <div class="footer"> 
            <p>© 2021 Predict'IF - Tous droits réservés</p>
        </div>

        <!-- Banner Image -->
        <div class="banner-image">
            <div class="banner-text"> </div>
            <div class="banner-text">
                <h1><strong>Il est temps de regarder votre avenir droit dans les yeux.</strong></h1>
                <p>Explorez les tréfonds de votre esprit accompagné de médiums<br />professionnels certifiés</p>
                <p><strong>Un voyant à votre service, maintenant, par téléphone</strong></p>
                <br />
                <button id="boutonPopupConnexion2">Commencer l'aventure, faire appel</button>
            </div>
        </div>

        <div class="panelContainer"> 
            <!-- Mediums -->
            <div class="panel" id="panelMediums">
                <h1><span class="ligne">Nos meilleurs médiums</span></h1>
                <div id="listeMediums"></div>
            </div>
            <!-- Commentaires -->
            <div class="panel" id="panelCommentaires">
                <h1><span class="ligne">Avis récents</span></h1>
                <div id="commentaires">
                    <div class="itemCommentaire">
                        <div class="nomClientCommentaire">GérometteDu69</div> 
                        <div class="noteCommentaire">&starf;&starf;&starf;&starf;&starf;</div>
                        <div class="contenuCommentaire">Prédict’if m’a permis de m’ouvrir les yeux vers de nouveaux horizons que je penseai inimaginables.. Merci Mme.IRMA bravo 5/5 étoiles</div>
                    </div>
                    <div class="itemCommentaire">
                        <div class="nomClientCommentaire">_-_OdileSupreme_-_</div> 
                        <div class="noteCommentaire">&starf;&starf;&starf;&starf;&star;</div>
                        <div class="contenuCommentaire">Je ne croyais pas en les pouvoirs cosmiques, mais le professionalisme et la rigueur de BARKABA Junior m’ont convaincu de l’authorité des étoiles</div>
                    </div>
                    <div class="itemCommentaire">
                        <div class="nomClientCommentaire">Donald T.</div> 
                        <div class="noteCommentaire">&starf;&starf;&starf;&starf;&starf;</div>
                        <div class="contenuCommentaire">L’astrologie n’était pour moi qu’un art obscur, jusqu’à ma première scéance avec Mr N’TOMA. Ses méthodes de consultations des astres agressives ont sauvé mon mariage. Maintenant, je suis divorcé, mais heureux :-)</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Popup de connexion -->
        <div id="overlayConnexion" class="popup">
            <div class="popupConnexion">
                <span id="fermerPopupConnexion" class="fermerPopup">&times;</span>
                <h1><span class="ligne">Se connecter</span></h1>
                <br/>
                <table>
                    <tr>
                        <td><strong>Adresse Mail :</strong></td>
                        <td><div><input type="text" id="champ-mail-connexion" /></div></td>
                    </tr>
                    <tr>
                        <td><strong>Mot de Passe :</strong></td>
                        <td><div><input type="password" id="champ-mdp-connexion" /></div></td>
                    </tr>
                    <tr>
                        <td colspan=2><div class="boutonConnecter"><button id="bouton-connexion">Connexion</button></div></td>
                    </tr>
                </table>
                <p><strong>Vous n'avez pas de compte? <a href="#" id="boutonPopupInscription2" class="hyperlien">Inscrivez-vous</a> en 2 clics</strong></p>
                <p id="messageErreurConnexion" class="texteErreur"></p>
            </div>
        </div>

        <!-- Popup d'inscription -->
        <div id="overlayInscription" class="popup">
            <div class="popupInscription">
                <span id="fermerPopupInscription" class="fermerPopup">&times;</span>
                <h1><span class="ligne">S'inscrire</span></h1>
                <br/>
                <div id="formulaireInscription">
                    <div class="compteGrid">
                        <div class="compteInfoPrenom">
                            <div class='compteLabel'> Prénom : </div>  
                            <div class='compteForm'> <input type="text" id="champ-prenom-inscription"/> </div>
                        </div>
                        <div class="compteInfoNom">
                            <div class='compteLabel'> Nom : </div>  
                            <div class='compteForm'> <input type="text" id="champ-nom-inscription"/> </div>
                        </div>
                        <div class="compteInfoDateNaissance">
                            <div class='compteLabel'> Date de Naissance : </div>  
                            <div class='compteForm'> <input type="date" id="champ-date-naissance-inscription"/> </div>
                        </div>
                        <div class="compteInfoCodePostal">
                            <div class='compteLabel'> Code Postal : </div>  
                            <div class='compteForm'> <input type="text" id="champ-code-postal-inscription"/> </div>
                        </div>
                        <div class="compteInfoTelephone">
                            <div class='compteLabel'> Téléphone : </div>  
                            <div class='compteForm'> <input type="tel" id="champ-tel-inscription"/> </div>
                        </div>
                        <div class="separateur1"><hr/></div>
                        <div class="compteInfoEmail">
                            <div class='compteLabel'> Adresse Mail : </div>  
                            <div class='compteForm'> <input type="text" id="champ-mail-inscription"/> </div>
                        </div>
                        <div class="compteInfoMdp">
                            <div class='compteLabel'> Mot de Passe : </div>  
                            <div class='compteForm'> <input type="password" id="champ-mdp-inscription"/> </div>
                        </div>
                        <div class="separateur2"><hr/></div>
                        <div class="boutonInscrire"> 
                            <button id="bouton-inscription">Inscription</button>
                        </div>
                    </div>
                    <p id="messageErreurInscription" class="texteErreur"></p>
                </div>
                <div id="confirmationInscription" style="display: none;">
                    <hr /><br />
                    <p><strong>
                            Inscription réussie!
                            <br /><br /> 
                            Vous recevrez un mail de confirmation suite auquel vous pourrez vous <a href="#" id="boutonPopupConnexion3" class="hyperlien">Connecter</a>.
                            <br />
                        </strong></p>
                </div>
            </div>
        </div>

        <script>

            // INITIALISATION
            $(document).ready(function () {

                // REDIRIGER VERS UNE AUTRE PAGE SI CE N'EST PAS LE BON USER
                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        todo: 'obtenirTypeUtilisateurCourant'
                    },
                    dataType: 'json'
                })
                        .done(function (response) {
                            console.log('Response', response);
                            // Si l'utilisateur est déjà logué
                            if (response.utilisateur) {
                                // Employé: le rediriger
                                if (response.type == "employe") {
                                    window.location.replace("tableau-de-bord.html");
                                }
                                // Client: changer les boutons du header et le lien du bouton
                                else {
                                    $('#headerContent').html(
                                            "<a href='demande-consultation.html'>Demander une Consultation</a>" +
                                            "<a href='historique.html'>Historique</a>" +
                                            "<a href='profil.html'>Profil</a>" +
                                            "<a class='boutonDeconnexion'>Déconnexion</a>"
                                            );
                                    $('#boutonPopupConnexion2').click(function () {
                                        window.location.replace("demande-consultation.html")
                                    });
                                    // Afficher la page
                                    $('body').css({"display": "block"});
                                }
                            } else {
                                // Afficher la page
                                $('body').css({"display": "block"});
                            }
                        })
                        .fail(function (error) {
                            console.log('Error', error);
                            alert("Erreur obtenirTypeUtilisateurCourant");
                        });
                        
                // REMPLIR LA LISTE DES MEDIUMS
                $.ajax({
                    url: './ActionServlet',
                    method: 'GET',
                    data: {
                        todo: 'obtenirListeMediums'
                    },
                    dataType: 'json'
                })
                        .done(function (response) {
                            var selectionMediums = [6, 3, 10, 1, 4];
                            var htmlString = "";
                            for (var i in selectionMediums) {
                                var indexMedium = selectionMediums[i]
                                var medium = response.listeMediums[indexMedium];
                                htmlString += "<div class='itemMedium' genre='" + medium.genre + "'>";
                                htmlString += "<div class='flexContainerMedium'>";
                                // Image et type
                                htmlString += "<div class='mediumLeft'>";
                                htmlString += "<img class='imageMedium' src=\"STYLES/IMAGES/MEDIUMS/" + medium.denomination + ".jpg\" width='100'>";
                                htmlString += "<span class='typeMedium'>" + medium.type + "</span>";
                                htmlString += "</div>";
                                // Description textuelle
                                htmlString += "<div class='mediumRight'>";
                                htmlString += "<span class='denominationMedium'>" + medium.denomination + "</span><br/>";
                                htmlString += "<span class='presentationMedium'>" + medium.presentation + "</span><br/>";
                                switch (medium.type) {
                                    case "Astrologue":
                                        htmlString += "<span class='complementMedium'><strong>Formation : </strong>" + medium.formation + "<br/>";
                                        htmlString += "<strong>Promotion : </strong>" + medium.promotion + "</span>";
                                        break;
                                    case "Spirite":
                                        htmlString += "<span class='complementMedium'><strong>Support :</strong> " + medium.support + "</span>";
                                        break;
                                }
                                htmlString += "</div>";
                                htmlString += "</div>";
                                htmlString += "</div>";
                            }
                            $('#listeMediums').html(htmlString);
                        })
                        .fail(function (error) {
                            console.log('Error', error);
                            alert("Erreur obtenirListeMediums");
                        })
            });
            
            // SERVICE CONNEXION
            $('#bouton-connexion').on('click', function () {

                console.log("clic sur le bouton de connexion");
                $('#bouton-connexion').html("Connexion...");
                $('#bouton-connexion').addClass("selected");
                $('#messageErreurConnexion').html("");
                // Récupération de la valeur des champs du formulaire
                var champMail = $('#champ-mail-connexion').val();
                var champMdp = $('#champ-mdp-connexion').val();
                // Si les champs sont vides, arrêter
                if (champMail == '' || champMdp == '') {
                    $('#messageErreurConnexion').html("Veuillez compléter tous les champs");
                    $('#bouton-connexion').html("Connexion");
                    $('#bouton-connexion').removeClass("selected");
                    return;
                }

                // Appel AJAX
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        todo: 'connexion',
                        login: champMail,
                        password: champMdp
                    },
                    dataType: 'json'
                })
                        .done(function (response) {
                            console.log('Response', response);
                            // Si la connexion a réussi (utilisateur retourné)...
                            if (response.utilisateur) {
                                // S'il est de type client...
                                if (response.type == "client") {
                                    // Rediriger vers la page Demande Consultation
                                    window.location.replace("demande-consultation.html");
                                }
                                // S'il est de type employé...
                                else {
                                    // Rediriger vers la page Tableau de Bord
                                    window.location.replace("tableau-de-bord.html");
                                }
                            }
                            // Sinon...
                            else {
                                // Afficher un message d'erreur
                                $('#messageErreurConnexion').html("Erreur de connexion. Veuillez réessayer");
                            }
                        })
                        .fail(function (error) {
                            console.log('Error', error);
                            alert("Erreur connexion");
                        })
                        .always(function () {
                            $('#bouton-connexion').html("Connexion");
                            $('#bouton-connexion').removeClass("selected");
                        });
            });
            // SERVICE INSCRIPTION
            $('#bouton-inscription').on('click', function () {

                console.log("clic sur le bouton de inscription");
                $('#bouton-inscription').html("Inscription...");
                $('#bouton-inscription').addClass("selected");
                $('#messageErreurInscription').html("");
                // Récupération de la valeur des champs du formulaire
                var champNom = $('#champ-nom-inscription').val();
                var champPrenom = $('#champ-prenom-inscription').val();
                var champDateNaissance = $('#champ-date-naissance-inscription').val();
                var champCodePostal = $('#champ-code-postal-inscription').val();
                var champTel = $('#champ-tel-inscription').val();
                var champMail = $('#champ-mail-inscription').val();
                var champMdp = $('#champ-mdp-inscription').val();
                // Si les champs sont vides, arrêter
                if (champNom == '' || champPrenom == '' || champDateNaissance == '' || champCodePostal == '' || champTel == '' || champMail == '' || champMdp == '') {
                    $('#messageErreurInscription').html("Veuillez compléter tous les champs");
                    $('#bouton-inscription').html("Inscription");
                    $('#bouton-inscription').removeClass("selected");
                    return;
                }

                // Appel AJAX
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        todo: 'inscription',
                        nom: champNom,
                        prenom: champPrenom,
                        dateNaissance: champDateNaissance,
                        codePostal: champCodePostal,
                        tel: champTel,
                        email: champMail,
                        mdp: champMdp

                    },
                    dataType: 'json'
                })
                        .done(function (response) {
                            console.log('Response', response);
                            // Si l'inscription a réussi (utilisateur retourné)...
                            if (response.utilisateur) {
                                // Cacher le formulaire et afficher la confirmation d'inscription
                                formulaireInscription.style.display = "none";
                                confirmationInscription.style.display = "block";
                            }
                            // Sinon...
                            else {
                                // Afficher un message d'erreur
                                $('#messageErreurInscription').html("Erreur d'inscription. Veuillez réessayer");
                            }
                        })
                        .fail(function (error) {
                            console.log('Error', error);
                            alert("Erreur inscription");
                        })
                        .always(function () {
                            $('#bouton-inscription').html("Inscription");
                            $('#bouton-inscription').removeClass("selected");
                        });
            });
            // POPUP DE CONNEXION
            // Fonction d'ouverture du popup
            function showPopupConnexion() {
                // Désafficher popup inscription
                overlayInscription.style.display = "none";
                // Afficher
                overlayConnexion.style.display = "block";
                // Reset les éléments
                $('#messageErreurConnexion').html("");
                $('#bouton-connexion').html("Connexion");
                $('#champ-mail-connexion').val('');
                $('#champ-mdp-connexion').val('');
            }
            // Fonction de fermeture
            function hidePopupConnexion() {
                overlayConnexion.style.display = "none";
            }
            // Attribuer les fonctions
            $('#boutonPopupConnexion1').click(showPopupConnexion);
            $('#boutonPopupConnexion2').click(showPopupConnexion);
            $('#boutonPopupConnexion3').click(showPopupConnexion);
            $('#fermerPopupConnexion').click(hidePopupConnexion);
            // POPUP D'INSCRIPTION
            // Fonction d'ouverture du popup
            function showPopupInscription() {
                // Reset les divs
                formulaireInscription.style.display = "block";
                confirmationInscription.style.display = "none";
                // Désafficher popup connexion
                overlayConnexion.style.display = "none";
                // Afficher
                overlayInscription.style.display = "block";
                // Reset les éléments
                $('#messageErreurInscription').html("");
                $('#bouton-inscription').html("Inscription");
                $('#champ-nom-inscription').val('');
                $('#champ-prenom-inscription').val('');
                $('#champ-date-naissance-inscription').val('');
                $('#champ-mail-inscription').val('');
                $('#champ-code-postal-inscription').val('');
                $('#champ-tel-inscription').val('');
                $('#champ-mail-inscription').val('');
                $('#champ-mdp-inscription').val('');
            }
            // Fonction de fermeture
            function hidePopupInscription() {
                overlayInscription.style.display = "none";
            }
            // Attribuer les fonctions
            $('#boutonPopupInscription1').click(showPopupInscription);
            $('#boutonPopupInscription2').click(showPopupInscription);
            $('#fermerPopupInscription').click(hidePopupInscription);
            // FERMETURE AUTOMATIQUE DES POPUPS
            window.onclick = function (event) {
                if (event.target === overlayConnexion) {
                    hidePopupConnexion();
                }
                if (event.target === overlayInscription) {
                    hidePopupInscription();
                }
            };
            // BOUTON DECONNEXION 
            $('body').on('click', 'a.boutonDeconnexion', function () {
                if (confirm("Êtes-vous sûrs de vouloir vous déconnecter ?")) {
                    $.ajax({
                        url: './ActionServlet',
                        method: 'POST',
                        data: {
                            todo: 'demandeDeconnexion'
                        },
                        dataType: 'json'
                    })
                            .done(function () {
                                window.location.replace("index.html");
                            })
                            .fail(function (error) {
                                console.log('Error', error);
                                alert("Nous n'avons pas pu vous déconnecter.");
                            });
                }
            });


        </script>

    </body>
</html>
